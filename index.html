<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* --- Global Reset & Layout --- */
        * { box-sizing: border-box; }
        body {
            background-color: #eef2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* --- Main Layout Container --- */
        .app-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            width: 100%;
            max-width: 1000px;
        }

        /* --- Editor Panel (Left Side) --- */
        .editor-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            flex: 1;
            min-width: 300px;
        }

        .editor-panel h2 { margin-top: 0; color: #333; }
        
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 13px; font-weight: 600; color: #666; margin-bottom: 5px; }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        /* Item Row in Editor */
        .item-row {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            align-items: center;
        }
        .item-row input { padding: 8px; }
        .item-row .qty { width: 60px; }
        .item-row .desc { flex-grow: 1; }
        .item-row .rate { width: 80px; }
        .remove-btn {
            background: #ffebee;
            color: #c62828;
            border: none;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }

        .add-btn {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px dashed #1565c0;
            width: 100%;
            padding: 10px;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .add-btn:hover { background-color: #bbdefb; }

        /* --- Receipt Preview (Right Side) --- */
        .receipt-wrapper {
            flex: 0 0 auto;
        }

        #receipt-box {
            background-color: #fff;
            width: 380px; /* Thermal printer width approx */
            padding: 20px 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-family: 'Courier New', Courier, monospace;
            color: #000;
            position: relative;
        }

        /* Receipt Typography */
        .r-center { text-align: center; }
        .r-right { text-align: right; }
        .r-bold { font-weight: bold; }
        
        .r-header h1 { font-size: 18px; margin: 0 0 5px 0; text-transform: uppercase; }
        .r-header p { margin: 2px 0; font-size: 13px; }
        
        .r-divider { border-bottom: 2px solid #000; margin: 10px 0; }
        .r-divider-dashed { border-bottom: 1px dashed #000; margin: 10px 0; }

        .r-invoice-title { font-size: 18px; margin: 15px 0 5px 0; }

        /* Receipt Table */
        .r-table { width: 100%; font-size: 14px; border-collapse: collapse; }
        .r-table th { text-align: left; border-bottom: 1px dashed #000; padding-bottom: 5px; }
        .r-table td { padding: 4px 0; vertical-align: top; }
        
        .col-qty { width: 10%; }
        .col-item { width: 45%; }
        .col-rate { width: 20%; text-align: right; }
        .col-amt { width: 25%; text-align: right; }

        /* Receipt Totals */
        .r-totals { margin-top: 10px; border-top: 2px solid #000; padding-top: 5px; }
        .r-total-row { display: flex; justify-content: space-between; font-size: 14px; margin: 3px 0; }

        .r-footer { font-size: 12px; margin-top: 20px; text-align: center; }

        /* --- Action Buttons --- */
        .actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .btn-action {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: white;
            transition: 0.2s;
        }
        .btn-print { background-color: #333; }
        .btn-dl { background-color: #2e7d32; }
        .btn-action:hover { opacity: 0.9; }

        /* --- Print Mode --- */
        @media print {
            body { background: white; padding: 0; margin: 0; }
            .editor-panel, .actions, .r-header-controls { display: none !important; }
            .app-container { display: block; }
            .receipt-wrapper { width: 100%; margin: 0; }
            #receipt-box { box-shadow: none; width: 100%; max-width: 100%; margin: 0; padding: 0; }
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            #receipt-box { width: 100%; }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <div class="editor-panel">
        <h2>Receipt Details</h2>
        
        <div class="input-group">
            <label>Company Name</label>
            <input type="text" id="in-comp-name" value="Premium Graphics (Pvt) Ltd." oninput="updateReceipt()">
        </div>
        <div class="input-group">
            <label>Address Line</label>
            <input type="text" id="in-addr" value="#185, Main Street, Sainthamaruthu - 01." oninput="updateReceipt()">
        </div>
        <div class="input-group">
            <label>Contact Info</label>
            <input type="text" id="in-contact" value="Mob : 074 0069 589 / 075 4449 234" oninput="updateReceipt()">
        </div>
        <div class="input-group">
            <label>Date</label>
            <input type="date" id="in-date" oninput="updateReceipt()">
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        
        <label style="font-weight:600; color:#666; display:block; margin-bottom:10px;">Items</label>
        <div id="items-container">
            </div>

        <button class="add-btn" onclick="addNewItem()">+ Add Item</button>

        <div class="input-group">
            <label>Advance Payment</label>
            <input type="number" id="in-advance" value="0" oninput="calculateAndUpdate()">
        </div>
    </div>

    <div class="receipt-wrapper">
        <div id="receipt-box">
            
            <div class="r-center r-header">
                <h1 id="r-comp-name">Premium Graphics (Pvt) Ltd.</h1>
                <p id="r-addr">#185, Main Street, Sainthamaruthu - 01.</p>
                <p id="r-contact">Mob : 074 0069 589 / 075 4449 234</p>
            </div>

            <div class="r-divider"></div>

            <div class="r-center">
                <div class="r-invoice-title r-bold">INVOICE</div>
            </div>

            <div style="margin-bottom: 10px;">
                <p>Date : <span id="r-date">--</span></p>
            </div>

            <table class="r-table">
                <thead>
                    <tr>
                        <th class="col-qty">Qty</th>
                        <th class="col-item">Item</th>
                        <th class="col-rate">Rate</th>
                        <th class="col-amt">Amount</th>
                    </tr>
                </thead>
                <tbody id="r-tbody">
                    </tbody>
            </table>

            <div class="r-totals">
                <div class="r-total-row r-bold">
                    <span>TOTAL</span>
                    <span id="r-total">0.00</span>
                </div>
                <div class="r-total-row">
                    <span>ADVANCE</span>
                    <span id="r-advance">0.00</span>
                </div>
                <div class="r-total-row">
                    <span>BALANCE</span>
                    <span id="r-balance">0.00</span>
                </div>
            </div>

            <div class="r-divider"></div>

            <div class="r-footer">
                <p>Thank you very much, Come Again..!</p>
            </div>
        </div>

        <div class="actions">
            <button class="btn-action btn-print" onclick="window.print()">Print</button>
            <button class="btn-action btn-dl" onclick="downloadImage()">Download</button>
        </div>
    </div>
</div>

<script>
    // Initialize date to today
    document.getElementById('in-date').valueAsDate = new Date();

    // Store items data
    let items = [
        { qty: 6, desc: "ID CARD PRINT", rate: 200 }
    ];

    // --- Core Functions ---

    // 1. Render the Input List based on the 'items' array
    function renderInputList() {
        const container = document.getElementById('items-container');
        container.innerHTML = '';

        items.forEach((item, index) => {
            const row = document.createElement('div');
            row.className = 'item-row';
            row.innerHTML = `
                <input type="number" class="qty" placeholder="Qty" value="${item.qty}" oninput="updateItem(${index}, 'qty', this.value)">
                <input type="text" class="desc" placeholder="Item Name" value="${item.desc}" oninput="updateItem(${index}, 'desc', this.value)">
                <input type="number" class="rate" placeholder="Rate" value="${item.rate}" oninput="updateItem(${index}, 'rate', this.value)">
                <button class="remove-btn" onclick="removeItem(${index})">x</button>
            `;
            container.appendChild(row);
        });

        calculateAndUpdate();
    }

    // 2. Add New Item
    function addNewItem() {
        items.push({ qty: 1, desc: "", rate: 0 });
        renderInputList();
    }

    // 3. Remove Item
    function removeItem(index) {
        items.splice(index, 1);
        renderInputList();
    }

    // 4. Update Item Data when typing
    function updateItem(index, field, value) {
        if(field === 'qty' || field === 'rate') {
            items[index][field] = parseFloat(value) || 0;
        } else {
            items[index][field] = value;
        }
        calculateAndUpdate();
    }

    // 5. Calculate Totals & Update Receipt View
    function calculateAndUpdate() {
        const tbody = document.getElementById('r-tbody');
        tbody.innerHTML = '';
        
        let total = 0;

        items.forEach(item => {
            const amount = item.qty * item.rate;
            total += amount;

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${item.qty}</td>
                <td>${item.desc}</td>
                <td class="r-right">${item.rate.toFixed(2)}</td>
                <td class="r-right">${amount.toFixed(2)}</td>
            `;
            tbody.appendChild(tr);
        });

        // Get Advance
        const advance = parseFloat(document.getElementById('in-advance').value) || 0;
        const balance = total - advance;

        // Update DOM Totals
        document.getElementById('r-total').innerText = total.toFixed(2);
        document.getElementById('r-advance').innerText = advance.toFixed(2);
        document.getElementById('r-balance').innerText = balance.toFixed(2);

        updateReceipt(); // Sync text fields
    }

    // 6. Update Header Info
    function updateReceipt() {
        document.getElementById('r-comp-name').innerText = document.getElementById('in-comp-name').value;
        document.getElementById('r-addr').innerText = document.getElementById('in-addr').value;
        document.getElementById('r-contact').innerText = document.getElementById('in-contact').value;
        
        // Format Date
        const dateVal = document.getElementById('in-date').value;
        document.getElementById('r-date').innerText = dateVal;
    }

    // 7. Download Function
    function downloadImage() {
        const receipt = document.getElementById('receipt-box');
        html2canvas(receipt, { scale: 2 }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Receipt.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }

    // Initial Render
    renderInputList();
    updateReceipt();

</script>

</body>
</html>